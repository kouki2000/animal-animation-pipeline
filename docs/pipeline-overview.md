# 🐾 Animal Animation Pipeline — 全体設計概要

> このドキュメントは「なぜこの設計なのか」を理解するためのもの。  
> コードより先に読む。迷ったときに戻ってくる。

---

## 1. パイプライン全体フロー

```
【入力】
  動物の動画ファイル（.mp4 など）
        ↓
【Python: ポーズ推定】
  MediaPipe / DeepLabCut で各フレームの関節座標を検出
  → 出力: 関節のXY座標のリスト（フレームごと）
        ↓
【Python: JSON生成】
  座標データを Flutter が読めるJSON形式に変換
  → 物理ルールを適用して自然な動きに補正
  → 出力: animation_data.json
        ↓
【Flutter: アニメーション表示】
  JSONを読み込み CustomPaint でスケルトンを描画
  → AnimationController でフレームを再生
  → 出力: 画面上でなめらかに動く動物アニメーション
```

---

## 2. なぜ縦積み方式（逐次完成）なのか

### ❌ やりがちな失敗パターン（横積み）

複数の要素を同時に少しずつ進める方法。

| フレーム数 | 関節数 | 物理ルール |
|-----------|--------|-----------|
| 30% 完成  | 20% 完成 | 10% 完成 |

→ 一見進んでいるように見えるが、**どれも動かない**。  
→ 最後に全部つなごうとすると「ビッグバン統合」が起きて大崩壊する。

### ✅ この プロジェクトの方針（縦積み）

1つの指標を 100% にしてから次に進む。

```
Month 1: フレーム数を 0 → 60（100%完成）
              ↓ CP1確認（目視で60fps確認）
Month 2: 関節数を 0 → 16（100%完成）
              ↓ CP2確認
Month 3: 物理ルールを 0 → 7（100%完成）
              ↓ CP3確認
Month 4: 自動化・統合・完成
```

**メリット：**

- 各月末に「動くもの」が必ず存在する
- 問題が起きた場所が特定しやすい
- モチベーションが落ちにくい（達成感がある）

---

## 3. リアルさ3指標の上限根拠

### フレーム数：60フレーム

- 人間の目が「なめらか」と感じるのは 60fps が基準
- 映画は 24fps（映画レベルは Week 3 で達成）
- 最終的に 60fps = スマホアプリとして違和感のない品質

### 関節数：16関節

- 犬・馬の体を表現するのに最低限必要な関節数
- MediaPipe の Animal Pose は主要関節として約 16点を検出
- これ以上増やすと計算コストが上がり、モバイルで重くなる

| 関節 | 場所 |
|------|------|
| 鼻・左右耳 | 頭部（3点） |
| 左右肩・肘・手首 | 前脚（6点） |
| 左右股関節・膝・足首 | 後脚（6点） |
| 尾の根元 | 胴体（1点） |

### 物理ルール数：7ルール

- 動物の動きを「らしく」見せるための最低限のルール
- 7つあれば「ぎこちない機械的動き」を卒業できる

| # | ルール | 効果 |
|---|--------|------|
| 1 | 重力：脚は地面を超えない | 浮かない |
| 2 | 慣性：急に止まらない | なめらか |
| 3 | 関節角度制限：ありえない角度にならない | 自然 |
| 4 | 左右対称性：対角線の脚が連動 | リアルな歩行 |
| 5 | 体幹の上下ブレ：走るとき体が揺れる | 躍動感 |
| 6 | 頭の追従：体の動きに少し遅れてついてくる | 生き物感 |
| 7 | 着地衝撃：地面接触時に軽く沈む | 重さの表現 |

---

## 4. 接着確認チェックポイント（CP）

| CP | タイミング | 確認内容 |
|----|-----------|---------|
| CP1 | Month 1 末 | 60fps で犬がなめらかに走っているか目視確認 |
| CP2 | Month 2 末 | 16関節のスケルトンが正しく動画に重なるか確認 |
| CP3 | Month 3 末 | 物理ルール適用後に動きが自然に見えるか確認 |
| CP4 | Month 4 末 | 動画を入れたら自動でFlutter表示まで完結するか確認 |

> CPで NG が出たら次の Month には進まない。ここが品質の砦。

---

## 5. 使用技術スタック

| 役割 | 技術 |
|------|------|
| アニメーション表示 | Flutter (Dart) |
| ポーズ推定 | MediaPipe / DeepLabCut (Python) |
| データ形式 | JSON |
| バージョン管理 | GitHub |
| 進捗管理 | GitHub Projects + Excel ダッシュボード |

---

*最終更新: Month 0 Week 3*
